<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Billings</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!--
        DASHBOARD PAGE - Protected Route

        Purpose: Display user information (requires authentication)

        What you'll learn here:
        - Protected routes (redirect if not authenticated)
        - Making authenticated GET requests (with Bearer token)
        - Displaying data from API response
        - Handling token expiration (401 errors)
        - Logout functionality
    -->

    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-brand">Billings</a>
            <div class="nav-links">
                <a href="dashboard.html" class="nav-link active">Dashboard</a>
                <a href="quiz-select.html" class="nav-link">Practice Quiz</a>
                <a href="achievements.html" class="nav-link">Achievements</a>
                <a href="avatars.html" class="nav-link">Avatars</a>
                <a href="leaderboards.html" class="nav-link">Leaderboards</a>
            </div>
            <div class="nav-actions">
                <a href="login.html" id="nav-login" class="button button-secondary-outline">Login</a>
                <a href="signup.html" id="nav-signup" class="button button-primary">Sign Up</a>
                <button id="nav-logout" class="button button-danger-outline" style="display: none;">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container">

        <div class="dashboard">
            <div class="dashboard-header">
                <h1>üëã Welcome Back!</h1>
                <p>Your personal dashboard</p>
            </div>

            <!-- GAMIFICATION STATS -->
            <div id="profile-stats" style="display: none;">
                <div class="xp-display">
                    <div class="xp-header">
                        <div>
                            <div class="level-badge-large" id="level-badge">1</div>
                        </div>
                        <div style="flex: 1; margin-left: 20px;">
                            <div class="xp-current" id="xp-current">0 XP</div>
                            <div class="xp-to-next" id="xp-to-next">100 XP to Level 2</div>
                        </div>
                    </div>
                    <div id="xp-progress-bar"></div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-value" id="stat-quizzes">0</div>
                        <div class="stat-label">Quizzes Taken</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üî•</div>
                        <div class="stat-value" id="stat-streak">0</div>
                        <div class="stat-label">Current Streak</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üèÜ</div>
                        <div class="stat-value" id="stat-achievements">0</div>
                        <div class="stat-label">Achievements</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚≠ê</div>
                        <div class="stat-value" id="stat-avatars">0</div>
                        <div class="stat-label">Avatars Unlocked</div>
                    </div>
                </div>
            </div>

            <!-- PRACTICE QUIZ CTA -->
            <div class="quiz-cta-card">
                <h2>üéØ Ready to Practice?</h2>
                <p>Test your knowledge with CompTIA practice questions</p>
                <a href="quiz-select.html" class="button button-primary button-large">
                    Start Practice Quiz ‚Üí
                </a>
                <div class="quiz-stats">
                    <div class="stat-item">
                        <strong>4,170</strong>
                        <span>Total Questions</span>
                    </div>
                    <div class="stat-item">
                        <strong>4</strong>
                        <span>Exam Types</span>
                    </div>
                </div>
            </div>

            <!--
                LOADING INDICATOR

                Shows while fetching user data from API
                Hidden once data is loaded
            -->
            <div id="loading" class="loading-spinner">
                <p>Loading your information...</p>
            </div>

            <!--
                ERROR MESSAGE AREA

                Shows if:
                - Token is expired (401 Unauthorized)
                - Backend is down (network error)
                - Other API errors
            -->
            <div id="error-message" class="error-message" style="display: none;"></div>

            <!--
                USER INFO CARD

                Hidden by default, shown once data is loaded
                Populated with user data from GET /api/v1/auth/me
            -->
            <div id="user-info" class="card" style="display: none;">
                <h2>Your Information</h2>

                <div class="info-grid">
                    <div class="info-item">
                        <strong>User ID:</strong>
                        <span id="user-id">-</span>
                    </div>

                    <div class="info-item">
                        <strong>Email:</strong>
                        <span id="user-email">-</span>
                    </div>

                    <div class="info-item">
                        <strong>Username:</strong>
                        <span id="user-username">-</span>
                    </div>

                    <div class="info-item">
                        <strong>Account Status:</strong>
                        <span id="user-status">-</span>
                    </div>

                    <div class="info-item">
                        <strong>Account Created:</strong>
                        <span id="user-created">-</span>
                    </div>
                </div>
            </div>

            <!--
                TOKEN INFO CARD (Educational)

                Shows how JWT token works
            -->
            <div class="card">
                <h2>üîê Authentication Info</h2>
                <p>You are currently authenticated with a JWT token.</p>

                <details>
                    <summary>View Token Details (for learning)</summary>
                    <div class="code-block" style="margin-top: 10px;">
                        <strong>Your JWT Token:</strong><br>
                        <code id="token-display" style="word-break: break-all; font-size: 11px;">
                            Loading...
                        </code><br><br>

                        <strong>How it works:</strong>
                        <ul style="text-align: left; margin-top: 10px;">
                            <li>Token is stored in localStorage</li>
                            <li>Sent in Authorization header: <code>Bearer &lt;token&gt;</code></li>
                            <li>Backend validates token on every protected request</li>
                            <li>Token expires after 15 minutes (for security)</li>
                            <li>Logout clears token from localStorage</li>
                        </ul>
                    </div>
                </details>
            </div>

            <!--
                API REQUEST INFO (Educational)

                Shows what API call is being made
            -->
            <div class="api-info">
                <details>
                    <summary>API Details (for learning)</summary>
                    <div class="code-block">
                        <strong>Endpoint:</strong> GET /api/v1/auth/me<br><br>

                        <strong>Request Headers:</strong><br>
                        <code>
                            Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...<br>
                            Content-Type: application/json
                        </code><br><br>

                        <strong>Response (Success):</strong><br>
                        <code>
                            {<br>
                            &nbsp;&nbsp;"id": 1,<br>
                            &nbsp;&nbsp;"email": "user@example.com",<br>
                            &nbsp;&nbsp;"username": "johndoe",<br>
                            &nbsp;&nbsp;"is_active": true,<br>
                            &nbsp;&nbsp;"created_at": "2024-01-15T10:30:00"<br>
                            }
                        </code><br><br>

                        <strong>Response (Expired Token - 401):</strong><br>
                        <code>
                            {<br>
                            &nbsp;&nbsp;"detail": "Invalid or expired token"<br>
                            }
                        </code>
                    </div>
                </details>
            </div>

            <!--
                AVAILABLE EXAMS

                Show what CompTIA certifications are available
            -->
            <div class="card learning-card">
                <h3>üìö Available Certifications</h3>
                <ul class="feature-list">
                    <li><strong>CompTIA A+ (1101):</strong> Core 1 - Hardware & Networking (994 questions)</li>
                    <li><strong>CompTIA A+ (1102):</strong> Core 2 - Operating Systems & Security (1,048 questions)</li>
                    <li><strong>CompTIA Network+:</strong> Networking Fundamentals (1,141 questions)</li>
                    <li><strong>CompTIA Security+:</strong> Cybersecurity Fundamentals (987 questions)</li>
                </ul>
                <p style="margin-top: 15px; color: #666; font-size: 14px;">
                    Each quiz includes detailed explanations for every answer choice.
                </p>
            </div>
        </div>
    </div>

    <!--
        JAVASCRIPT MODULE

        The dashboard logic is in js/dashboard.js
        It handles:
        - Checking authentication
        - Fetching user data
        - Displaying user info
        - Logout functionality
    -->
    <script type="module" src="js/dashboard.js"></script>
</body>
</html>
